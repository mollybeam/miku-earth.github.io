<!DOCTYPE html>

<head>
    <meta charset="utf8">
    <title>Miku Worldwide</title>
    <!-- <meta name="theme-color" content="#FD7928"> -->
    <link rel="apple-touch-icon" sizes="180x180" href="static/icon180.png">
    <link rel="icon" type="image/png" sizes="512x512" href="static/icon512.png">
    <link rel="icon" type="image/png" sizes="32x32" href="static/icon32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="static/icon16.png">
    <link rel="manifest" href="static/site.webmanifest">

    <link rel="stylesheet" href="static/normalize.css" type="text/css">
    <link rel="stylesheet" href="https://unpkg.com/sakura.css/css/sakura.css" type="text/css">
    <link rel="stylesheet" href="static/style.css" type="text/css">

    <script src="https://unpkg.com/react@16.7.0/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/maplibre-gl@^2.4/dist/maplibre-gl.js"></script>
    <link rel="stylesheet" href="https://unpkg.com/maplibre-gl@^2.4/dist/maplibre-gl.css">

    <script src="static/mikus.js"></script>
</head>

<body>
    <div class="container">
        <header>
            <h1><a href="https://miku-earth.tumblr.com">miku earth</a>: <i>map</i></h1>
            <p>
                local mikus spotted in your area
                <small>(very much a work in progress!)</small>
            </p>
        </header>
        <div id="map"></div>
    </div>


    <!-- post-load script: -->
    <script>
        // yes i styled my own map. it was fun and hopefully makes for a nicer map experience!

        const MIKU_KEY = "7u4GIZgEyI3d1WRGQSI0";
        const DEV_KEY = "tKhcX9Y8K1Tuf3yejJxO";
        const KEY = DEV_KEY;
        var map = new maplibregl.Map({
            container: 'map', // container id
            style: `https://api.maptiler.com/maps/04d81168-126c-4527-92a3-10840848932d/style.json?key=${KEY}`,
            center: [0, 0], // starting position [lng, lat]
            zoom: 1 // starting zoom
        });

        map.on('load', () => {
            map
                .addSource('areas', {
                    type: 'vector',
                    url: `https://api.maptiler.com/data/ae1502a2-aa65-426a-8c80-6fa0685e0cd2/features.json?key=${KEY}`
                })
            // .addLayer({
            //     id: 'areas',
            //     type: 'fill',
            //     source: 'areas',
            //     'source-layer': 'features',
            //     paint: {
            //         'fill-color': '#888888',
            //         'fill-opacity': 0.5
            //     },
            //     // filter: ['==', ['get', 'name'], 'moravia1']
            // }, "")

            MIKUS.forEach(miku => {
                if (!miku.coords) return;


                // create a DOM element for the marker
                const el = document.createElement('div');
                el.className = 'miku';
                el.style.backgroundImage =
                    `url(${miku.img_min_url})`;
                el.style.width = `75px`;
                el.style.height = `75px`;

                el.addEventListener('click', () => {
                    console.log(miku);
                });

                let marker = new maplibregl.Marker({ element: el })
                    .setLngLat(miku.coords)
                    .addTo(map);
            });
        })


    </script>
</body>